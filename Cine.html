<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CineMoh ‚Äî Pel√≠culas y Funciones</title>
  <style>
    :root{
      --bg:#050306;
      --card:#12060a;
      --accent:#ff4b57;
      --muted:#bdb0b0;
      --glass: rgba(255,75,87,0.04);
      --radius:12px;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color-scheme: dark;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#12040a 0%,var(--bg) 100%); color:#f0e9ea}
    a{color:inherit;text-decoration:none}
    header{
      display:flex;align-items:center;justify-content:space-between;
      gap:1rem;padding:1rem 1.25rem;background:linear-gradient(180deg, rgba(255,75,87,0.02), transparent);
      position:sticky;top:0;backdrop-filter: blur(6px);z-index:20;border-bottom:1px solid rgba(255,75,87,0.03)
    }
    .brand{display:flex;align-items:center;gap:.75rem;font-weight:700;font-size:1.125rem}
    .logo{
      width:44px;height:44px;border-radius:10px;background:
      radial-gradient(circle at 30% 30%, #ffd6d8 0%, transparent 18%),
      linear-gradient(135deg,#ff6b6b, #b22222 60%);display:flex;align-items:center;justify-content:center;
      box-shadow:0 6px 20px rgba(255,75,87,0.12);flex:0 0 44px;color:#0b0a0d;font-weight:800
    }
    nav{display:flex;gap:0.5rem;align-items:center}
    .nav-links{display:flex;gap:.5rem}
    .nav-links a{padding:.5rem .75rem;border-radius:8px;font-weight:600;color:var(--muted);font-size:.95rem}
    .nav-links a:hover{background:var(--glass);color:#fff}
    .search{display:flex;align-items:center;gap:.5rem;background:var(--glass);padding:.45rem;border-radius:10px}
    .search input{background:transparent;border:0;color:inherit;outline:none;width:220px;padding:.15rem .25rem}
    .hero{
      padding:2rem 1.25rem 1.5rem;display:grid;grid-template-columns:1fr 360px;gap:1rem;align-items:start;
    }
    .hero-card{
      background:linear-gradient(180deg, rgba(255,75,87,0.02), rgba(255,75,87,0.01));
      border-radius:var(--radius);padding:1.25rem;min-height:220px;box-shadow:0 10px 30px rgba(3,10,18,0.6);
      overflow:hidden;position:relative
    }
    .featured{
      display:flex;gap:1.25rem;align-items:center;
    }
    .poster{
      width:140px;height:200px;border-radius:8px;flex:0 0 140px;overflow:hidden;
      background:linear-gradient(180deg,#30161a,#12060a);display:grid;place-items:center;color:#fff;font-weight:700;
      box-shadow:0 8px 24px rgba(0,0,0,0.6)
    }
    .movie-info h2{margin:0 0 .35rem 0;font-size:1.25rem}
    .movie-info p{margin:0;color:var(--muted);font-size:.95rem}
    .cta{margin-top:1rem;display:flex;gap:.5rem;flex-wrap:wrap}
    .btn{background:var(--accent);border:0;color:white;padding:.6rem .9rem;border-radius:10px;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,75,87,0.06);color:var(--muted);font-weight:600}
    .sidebar{
      padding:1rem;background:linear-gradient(180deg, rgba(255,75,87,0.01), transparent);
      border-radius:var(--radius);min-height:220px
    }
    main{padding:1rem 1.25rem}
    .section-title{display:flex;align-items:center;justify-content:space-between;margin-bottom:.75rem}
    .movies-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem}
    .movies-row{display:flex;gap:1rem;overflow:auto;padding-bottom:.25rem}
    .card{background:var(--card);border-radius:12px;padding:0.8rem;overflow:hidden;border:1px solid rgba(255,75,87,0.02);min-width:200px;flex:0 0 200px;cursor:pointer}
    .card .thumb{height:240px;border-radius:8px;background:linear-gradient(180deg,#24121a,#12060a);display:flex;align-items:end;padding:.6rem}
    .card h3{margin:.6rem 0 0 0;font-size:1rem}
    .meta{display:flex;align-items:center;gap:.5rem;color:var(--muted);font-size:.9rem;margin-top:.35rem}
    .showtimes{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.6rem}
    .chip{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:.35rem .5rem;border-radius:8px;font-weight:600;color:var(--muted);cursor:pointer}
    footer{padding:1.25rem;background:transparent;border-top:1px solid rgba(255,75,87,0.03);display:flex;justify-content:space-between;align-items:center}
    .overlay{position:fixed;inset:0;background:linear-gradient(180deg, rgba(23,6,8,0.6), rgba(10,4,6,0.85));display:none;align-items:center;justify-content:center;z-index:50}
    .overlay.open{display:flex}
    .modal{background:linear-gradient(180deg,#14060b,#12060a);padding:1rem;border-radius:12px;width:min(880px,96%);box-shadow:0 18px 60px rgba(2,6,23,0.8)}
    .modal-grid{display:grid;grid-template-columns:220px 1fr;gap:1rem}
    .time-list{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}
    .time-btn{padding:.5rem .7rem;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer;color:var(--muted);font-weight:700}
    .close{background:transparent;border:0;color:var(--muted);cursor:pointer;font-size:1rem}
    .tabs{display:flex;gap:.5rem;margin-bottom:1rem;flex-wrap:wrap}
    .tab-btn{padding:.5rem .75rem;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.03);color:var(--muted);cursor:pointer;font-weight:700}
    .tab-btn.active{background:var(--glass);color:#fff;border-color:rgba(255,255,255,0.06)}
    .tab-panel{display:none}
    .tab-panel.active{display:block}
    .form-row{display:flex;flex-direction:column;gap:.35rem;margin-bottom:.6rem}
    input,select,textarea{background:transparent;border:1px solid rgba(255,255,255,0.03);padding:.6rem;border-radius:8px;color:var(--muted);outline:none}
    @media (max-width:880px){
      .hero{grid-template-columns:1fr;gap:.75rem}
      .sidebar{order:2}
      .featured{flex-direction:row}
      .search input{width:120px}
      header{padding:.6rem .8rem}
      .card{min-width:150px}
    }
    .rating{background:linear-gradient(90deg,#ff9b9b,#ff4b57);padding:.25rem .45rem;border-radius:6px;font-weight:800;color:#12060a}
    .carousel-controls{display:flex;gap:.5rem;align-items:center}

    /* Seat map styles */
    .seat-map{display:grid;grid-template-columns:repeat(8,1fr);gap:8px;margin-top:.6rem}
    .seat{background:linear-gradient(180deg,#231219,#12060a);border:1px solid rgba(255,255,255,0.04);height:36px;border-radius:6px;display:grid;place-items:center;cursor:pointer;color:var(--muted);font-weight:700}
    .seat.reserved{background:#2b2b2b;color:#8a8a8a;cursor:not-allowed;opacity:.7;border-color:rgba(255,0,0,0.12)}
    .seat.selected{background:linear-gradient(135deg,#ff7b7b,#ff4b57);color:#12060a;border-color:var(--accent)}
    .seat-legend{display:flex;gap:.6rem;align-items:center;margin-top:.6rem;color:var(--muted);font-size:.9rem}
    .legend-item{display:flex;gap:.4rem;align-items:center}
    .legend-box{width:18px;height:18px;border-radius:4px}
  </style>
</head>
<body>
  <header>
  <div class="brand">
    <div class="logo" aria-hidden>CM</div>
    <div>
    <div style="font-weight:800">CineMoh</div>
    <div style="font-size:.75rem;color:var(--muted);margin-top:2px">Pel√≠culas ‚Ä¢ Funciones ‚Ä¢ Entradas</div>
    </div>
  </div>

  <nav>
    <div class="nav-links" role="navigation" aria-label="Principal">
    <a href="#" data-tab="peliculas" aria-current="page">En cartelera</a>
    <a href="#" data-tab="proximamente">Pr√≥ximamente</a>
    <a href="#" data-tab="ofertas">Ofertas</a>
    </div>

    <div style="display:flex;align-items:center;gap:.6rem;margin-left:1rem">
    <div class="search" role="search"></div>
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" style="opacity:.8"><path d="M21 21l-4.35-4.35" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/><circle cx="11" cy="11" r="6" stroke="currentColor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
      <input id="search" type="search" placeholder="Buscar pel√≠culas, g√©neros..." aria-label="Buscar pel√≠culas">
    </div>
    <button class="btn secondary" id="signIn">Iniciar sesi√≥n</button>
    <!-- NOTE: 'Agregar' button removed per request -->
    </div>
  </nav>
  </header>

  <section class="hero" aria-label="Destacado">
  <div class="hero-card" role="region" aria-labelledby="featuredTitle">
    <div style="display:flex;align-items:flex-start;justify-content:space-between">
    <div>
      <div style="color:var(--muted);font-weight:700;font-size:.9rem">Destacado</div>
      <h1 id="featuredTitle" style="margin:.35rem 0 .25rem;font-size:1.5rem">Vive el cine de otra manera</h1>
      <p style="margin:0;color:var(--muted);max-width:60%">Reserva entradas, descubre funciones y disfruta de pantallas premium con asientos reservados y sonido de calidad.</p>
    </div>
    <div style="text-align:right;color:var(--muted);font-size:.9rem">
      <div style="font-weight:800">En cartelera</div>
      <div id="nowCount">0 t√≠tulos</div>
    </div>
    </div>

    <div style="margin-top:1.1rem">
    <div style="display:flex;align-items:center;justify-content:space-between;gap:1rem">
      <div class="featured" id="heroFeatured" style="flex:1">
      <!-- Featured movie rendered by JS -->
      </div>
      <div class="carousel-controls">
      <button class="tab-btn" id="heroPrev" title="Anterior">‚óÄ</button>
      <button class="tab-btn" id="heroNext" title="Siguiente">‚ñ∂</button>
      </div>
    </div>

    <div class="cta">
      <button class="btn" id="viewNow">Ver funciones</button>
      <button class="btn secondary" id="browse">Ver todas</button>
    </div>
    </div>
  </div>

  <aside class="sidebar" aria-labelledby="sidebarTitle">
    <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <div id="sidebarTitle" style="font-weight:800">Selecciones r√°pidas</div>
      <div style="font-size:.9rem;color:var(--muted)">Funciones populares cerca de ti</div>
    </div>
    <div style="font-size:.85rem;color:var(--muted)">Hoy</div>
    </div>

    <div style="margin-top:.9rem;display:flex;flex-direction:column;gap:.6rem">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="display:flex;gap:.6rem;align-items:center">
      <div style="width:56px;height:80px;border-radius:8px;background:linear-gradient(180deg,#2a1014,#12060a)"></div>
      <div>
        <div style="font-weight:700">La Carrera de Medianoche</div>
        <div style="color:var(--muted);font-size:.85rem">20:30 ‚Ä¢ Sala 3</div>
      </div>
      </div>
      <button class="btn" id="quickBookFeatured">Reservar</button>
    </div>

    <div style="display:flex;justify-content:space-between;align-items:center">
      <div style="display:flex;gap:.6rem;align-items:center">
      <div style="width:56px;height:80px;border-radius:8px;background:linear-gradient(180deg,#2a1014,#12060a)"></div>
      <div>
        <div style="font-weight:700">Deriva Oce√°nica</div>
        <div style="color:var(--muted);font-size:.85rem">18:00 ‚Ä¢ Sala 1</div>
      </div>
      </div>
      <button class="btn secondary">Detalles</button>
    </div>

    <!-- NOTE: Form para a√±adir pel√≠cula eliminado por solicitud ("quitar el tab entero de agregar") -->
    </div>
  </aside>
  </section>

  <main>
  <div class="section-title">
    <h2 style="margin:0">En cartelera</h2>
    <div style="display:flex;gap:.5rem;align-items:center">
    <label style="color:var(--muted);font-size:.95rem">Filtrar:</label>
    <select id="genreFilter" style="background:transparent;border:1px solid rgba(255,255,255,0.03);padding:.4rem;border-radius:8px;color:var(--muted)">
      <option value="">Todos</option>
      <option>Acci√≥n</option>
      <option>Drama</option>
      <option>Animaci√≥n</option>
      <option>Terror</option>
    </select>
    </div>
  </div>

  <div class="tabs" role="tablist" aria-label="Secciones">
    <button class="tab-btn active" data-panel="panel-peliculas" role="tab" aria-selected="true">Pel√≠culas</button>
    <button class="tab-btn" data-panel="panel-detalles" role="tab">Detalles</button>
    <button class="tab-btn" data-panel="panel-proximas" role="tab">Pr√≥ximamente</button>
    <button class="tab-btn" data-panel="panel-ofertas" role="tab">Ofertas</button>
    <button class="tab-btn" data-panel="panel-login" role="tab">Iniciar sesi√≥n</button>
    <button class="tab-btn" data-panel="panel-registrar" role="tab">Registrarse</button>
    <button class="tab-btn" data-panel="panel-confirmacion" role="tab">Confirmaci√≥n</button>
  </div>

  <!-- Panels -->
  <section id="panel-peliculas" class="tab-panel active" aria-labelledby="tab-peliculas">
    <div>
    <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem">
      <div style="font-weight:800">Cartelera</div>
      <div style="color:var(--muted);font-size:.9rem">Desplaza para ver m√°s</div>
    </div>
    <div class="movies-row" id="moviesRow" aria-live="polite">
      <!-- Movie cards inserted by JS -->
    </div>
    </div>
  </section>

  <section id="panel-detalles" class="tab-panel" aria-hidden="true">
    <div class="hero-card">
    <div style="font-weight:800">Detalles de la pel√≠cula</div>
    <div id="detailContent" style="color:var(--muted);margin-top:.5rem">Seleccione una pel√≠cula para ver informaci√≥n detallada aqu√≠.</div>
    </div>
  </section>

  <section id="panel-proximas" class="tab-panel" aria-hidden="true">
    <div class="hero-card">
    <div style="font-weight:800">Pr√≥ximamente</div>
    <!-- IMPORTANT: Upcoming movies will show cards WITHOUT selectable showtimes.
       Users cannot reserve for pr√≥ximas pel√≠culas; they can only view details. -->
    <div id="upcomingRow" style="margin-top:.6rem" class="movies-row"></div>
    </div>
  </section>

  <section id="panel-ofertas" class="tab-panel" aria-hidden="true">
    <div class="hero-card">
    <div style="font-weight:800">Ofertas</div>
    <div style="margin-top:.6rem;color:var(--muted)">
      <p style="margin:.2rem 0">Promoci√≥n permanente de demo:</p>
      <div style="font-weight:800;margin-top:.25rem">2x1 en entradas los fines de semana</div>
      <p style="margin-top:.45rem">Aplicable s√°bados y domingos en las funciones indicadas. Seleccione una pel√≠cula y una funci√≥n y se aplicar√° la promoci√≥n en el proceso de compra (demo).</p>
    </div>
    </div>
  </section>

  <section id="panel-login" class="tab-panel" aria-hidden="true">
    <div class="hero-card" style="max-width:520px">
    <div style="font-weight:800">Iniciar sesi√≥n</div>
    <form id="loginForm" style="margin-top:.8rem">
      <div class="form-row">
      <label style="color:var(--muted)">Correo electr√≥nico</label>
      <input type="email" id="loginEmail" placeholder="tucorreo@ejemplo.com" required>
      </div>
      <div class="form-row">
      <label style="color:var(--muted)">Contrase√±a</label>
      <input type="password" id="loginPass" placeholder="Contrase√±a" required>
      </div>
      <div style="display:flex;gap:.5rem">
      <button class="btn" type="submit">Entrar</button>
      <button class="btn secondary" type="button" id="goRegister">Crear cuenta</button>
      </div>
      <div id="loginMsg" style="margin-top:.6rem;color:var(--muted)"></div>
    </form>
    </div>
  </section>

  <section id="panel-registrar" class="tab-panel" aria-hidden="true">
    <div class="hero-card" style="max-width:520px">
    <div style="font-weight:800">Crear cuenta</div>
    <form id="registerForm" style="margin-top:.8rem">
      <div class="form-row">
      <label style="color:var(--muted)">Nombre</label>
      <input type="text" id="regName" placeholder="Tu nombre" required>
      </div>
      <div class="form-row">
      <label style="color:var(--muted)">Correo electr√≥nico</label>
      <input type="email" id="regEmail" placeholder="tucorreo@ejemplo.com" required>
      </div>
      <div class="form-row">
      <label style="color:var(--muted)">Contrase√±a</label>
      <input type="password" id="regPass" placeholder="Contrase√±a" required>
      </div>
      <div style="display:flex;gap:.5rem">
      <button class="btn" type="submit">Registrar</button>
      <button class="btn secondary" type="button" id="goLogin">Volver a entrar</button>
      </div>
      <div id="registerMsg" style="margin-top:.6rem;color:var(--muted)"></div>
    </form>
    </div>
  </section>

  <section id="panel-confirmacion" class="tab-panel" aria-hidden="true">
    <div class="hero-card">
    <div style="font-weight:800">Confirmaci√≥n de compra</div>
    <div id="confirmContent" style="color:var(--muted);margin-top:.5rem">Aqu√≠ aparecer√° la confirmaci√≥n despu√©s de completar la compra.</div>
    </div>
  </section>
  </main>

  <footer>
  <div style="color:var(--muted)">¬© <span id="year"></span> CineMoh ‚Äî Todos los derechos reservados</div>
  <div style="color:var(--muted)">T√©rminos ‚Ä¢ Privacidad ‚Ä¢ Ayuda</div>
  </footer>

  <!-- Booking Modal -->
  <div class="overlay" id="overlay" role="dialog" aria-modal="true" aria-hidden="true">
  <div class="modal" role="document">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem">
    <div style="font-weight:800" id="modalTitle">Reserva</div>
    <button class="close" id="closeModal" aria-label="Cerrar">‚úï</button>
    </div>
    <div class="modal-grid">
    <div style="background:linear-gradient(180deg,#12060a,#0b0406);padding:.6rem;border-radius:8px"></div>
      <div id="modalPoster" style="height:280px;border-radius:8px;background:linear-gradient(180deg,#331017,#12060a);display:grid;place-items:center;font-weight:800"></div>
    </div>
    <div>
      <div id="modalInfo" style="color:var(--muted)"></div>
      <div style="margin-top:.6rem">
      <div style="font-weight:800">Selecciona funci√≥n</div>
      <div id="modalTimes" class="time-list"></div>

      <!-- Seats map -->
      <div id="seatContainer" style="margin-top:.6rem">
        <div style="font-weight:800">Selecciona butacas</div>
        <div id="seatMap" class="seat-map" aria-live="polite"></div>
        <div class="seat-legend">
          <div class="legend-item"><div class="legend-box" style="background:linear-gradient(135deg,#ff7b7b,#ff4b57);width:18px;height:18px;border-radius:4px"></div><div>Seleccionada</div></div>
          <div class="legend-item"><div class="legend-box" style="background:#2b2b2b;width:18px;height:18px;border-radius:4px"></div><div>Reservada</div></div>
          <div class="legend-item"><div class="legend-box" style="background:linear-gradient(180deg,#231219,#12060a);border:1px solid rgba(255,255,255,0.04);width:18px;height:18px;border-radius:4px"></div><div>Disponible</div></div>
        </div>
      </div>

      <div style="margin-top:.75rem;display:flex;gap:.6rem;align-items:center">
        <div style="font-weight:700">Entradas</div>
        <select id="ticketCount" style="background:transparent;border:1px solid rgba(255,255,255,0.03);padding:.35rem;border-radius:8px;color:var(--muted)">
        <option>1</option><option>2</option><option>3</option><option>4</option>
        </select>
        <button class="btn" id="confirmBuy">Confirmar</button>
      </div>
      <div id="bookingMessage" style="margin-top:.6rem;color:var(--muted)"></div>
      </div>
    </div>
    </div>
  </div>
  </div>

  <script>
  // ------------------------
  // Datos de ejemplo
  // ------------------------
  // Incluye The Batman, Nosferatu, One Battle After Another
  let movies = [
    { id:1, title:"Akira", title_es:"Akira", img:"akira.jpg", genre:"Acci√≥n", rating: "PG-13", runtime: "2h 4m", score: "9.5", desc:"En 1988, el gobierno japon√©s lanza una bomba at√≥mica sobre Tokio tras el fracaso de unos experimentos de percepci√≥n extrasensorial (PES) en ni√±os. En 2019, 31 a√±os despu√©s del bombardeo, Kaneda, l√≠der de una banda de motociclistas, intenta rescatar a su amigo Tetsuo de un proyecto secreto del gobierno. Se enfrenta a activistas antigubernamentales, pol√≠ticos corruptos, cient√≠ficos irresponsables y un poderoso l√≠der militar hasta que los poderes sobrenaturales de Tetsuo se manifiestan repentinamente. La batalla final tiene lugar en la Olimpiada de Tokio, donde se revelan los secretos del experimento.", times:["12:30","15:45","19:00","22:20"], featured:true, upcoming:false },
    { id:2, title:"Shaolin Soccer", title_es:"Shaolin Soccer", img:"shaolinSoccer.jpg", genre:"Comedia", rating: "PG-13", runtime: "1h 53m", score: "8.5", desc:"Toda su vida, un joven com√∫n y corriente ha sido tratado como un trapo. Aun as√≠, nunca ha perdido la esperanza de que todos los problemas del mundo se puedan resolver con un poco de kung fu. Por eso, se une a un grupo de inadaptados ‚Äîseis amigos que fueron maestros de kung fu en su juventud‚Äî para formar un equipo de f√∫tbol que, seg√∫n √©l, tiene posibilidades de ganar un gran premio de un mill√≥n de d√≥lares. Juntos, aplicar√°n sus talentos ocultos a un juego completamente nuevo, y el f√∫tbol jam√°s volver√° a ser el mismo.", times:["11:00","14:00","18:30"], featured:false, upcoming:false },
    { id:3, title:"Aftersun", title_es:"Aftersun", img:"aftersun.jpg", genre:"Drama", rating: "G", runtime: "1h 42m", score: "8.9", desc:"Veinte a√±os despu√©s de sus √∫ltimas vacaciones en un balneario decadente, Sophie reflexiona sobre el escaso tiempo que pas√≥ con su cari√±oso e idealista padre, Calum. A sus once a√±os, mientras el mundo de la adolescencia se abre paso en la mente de Sophie, Calum lucha bajo el peso de la vida sin la paternidad. Los recuerdos de Sophie se convierten en un retrato conmovedor y profundo de su relaci√≥n, mientras intenta reconciliar al padre que conoci√≥ con el hombre que nunca lleg√≥ a conocer.", times:["10:00","12:45","16:00","18:15"], featured:true, upcoming:false },
    { id:4, title:"Ojue", title_es:"Ojue", img:"ojue.jpg", genre:"Comedia", rating: "E", runtime: "13m", score: "1.0", desc:"Yeyesita wannabe gringa se da cuenta de que es inaut√©ntca, superficial, y vendepatria: una historia inspirada en Fernando Broce.", times:["20:30","22:45"], featured:false, upcoming:false },
    { id:5, title:"Anatom√≠a de una ca√≠da", title_es:"Anatom√≠a de una ca√≠da", img:"anatomia.jpg", genre:"Drama", rating: "PG-16", runtime: "2h 31m", score: "8.7", desc:"Sandra, una escritora alemana, vive con su marido Samuel y su hijo ciego, Daniel, en un chal√© en medio de los Alpes franceses. Cuando Samuel fallece en misteriosas circunstancias, la investigaci√≥n no puede determinar si se trata de un suicidio o de un homicidio. Sandra es arrestada y juzgada por asesinato, y el proceso pone su tumultuosa relaci√≥n y su ambigua personalidad en el punto de mira.", times:["13:15","16:30","19:30"], featured:false, upcoming:false },
    { id:6, title:"The Batman", title_es:"The Batman", img:"the-batman.jpg", img:"theBatman.jpg", genre:"Acci√≥n", rating:"R", runtime:"2h 55m", score:"9.2", desc:"Batman es llamado a intervenir cuando el alcalde de Gotham City es asesinado. Pronto, su investigaci√≥n lo lleva a descubrir una red de corrupci√≥n, vinculada a su propio y oscuro pasado.", times:["17:00","20:10","23:30"], featured:true, upcoming:false },
    { id:7, title:"Nosferatu", title_es:"Nosferatu", img:"nosferatu.jpg", genre:"Terror", rating:"R", runtime:"1h 46m", score:"9.4", desc:"Una reinterpretaci√≥n del cl√°sico del horror.", times:[], featured:false, upcoming:true },
    { id:8, title:"Una Batalla Tras Otra", title_es:"Una Batalla Tras Otra", img:"unaBatalla.jpg", genre:"Acci√≥n", rating:"PG-13", runtime:"2h 20m", score:"9.3", desc:"Bob, un revolucionario acabado (Leonardo DiCaprio) se mantiene en un estado de paranoia inducida por las drogas y sobrevive aislado junto con su vivaz e independiente hija, Willa (Chase Infiniti). Cuando su malvado n√©mesis (Sean Penn) resurge despu√©s de 16 a√±os y Willa desaparece, el exradical se lanza a buscarla mientras ambos, padre e hija, deber√°n enfrentarse a las consecuencias de su pasado.", times:[], featured:false, upcoming:true }
  ];

  // Add reserved seats storage for each movie (per time)
  movies.forEach(m=>{
    m.reserved = m.reserved || {}; // object mapping time -> array of seatIds
    (m.times||[]).forEach(t=>{
      if(!m.reserved[t]) m.reserved[t] = []; // initialize empty array
    });
  });

  // ------------------------
  // Referencias DOM
  // ------------------------
  const moviesRow = document.getElementById('moviesRow');
  const upcomingRow = document.getElementById('upcomingRow');
  const nowCount = document.getElementById('nowCount');
  const heroFeatured = document.getElementById('heroFeatured');
  const year = document.getElementById('year');
  const overlay = document.getElementById('overlay');
  const modalTitle = document.getElementById('modalTitle');
  const modalPoster = document.getElementById('modalPoster');
  const modalInfo = document.getElementById('modalInfo');
  const modalTimes = document.getElementById('modalTimes');
  const bookingMessage = document.getElementById('bookingMessage');
  const ticketCount = document.getElementById('ticketCount');
  const confirmBuy = document.getElementById('confirmBuy');
  const closeModal = document.getElementById('closeModal');
  const search = document.getElementById('search');
  const genreFilter = document.getElementById('genreFilter');
  const detailContent = document.getElementById('detailContent');
  const confirmContent = document.getElementById('confirmContent');
  const seatMapEl = document.getElementById('seatMap');

  year.textContent = new Date().getFullYear();

  // ------------------------
  // Helpers / Posters
  // ------------------------
  // Poster helper: will use a movie.img if available.
  function posterSVG(movieOrTitle){
    // If an object with img was passed, use it directly
    if(typeof movieOrTitle === 'object' && movieOrTitle !== null && movieOrTitle.img){
      const src = String(movieOrTitle.img).replace(/"/g,'');
      const alt = (movieOrTitle.title_es || movieOrTitle.title || 'P√≥ster').replace(/"/g,'');
      return `<img src="${src}" alt="${alt}" style="width:100%; height:100%; object-fit:cover; border-radius: inherit;">`;
    }

    // If a string (title) was passed, try to find a matching movie with an img
    if(typeof movieOrTitle === 'string'){
      const title = movieOrTitle.trim().toLowerCase();
      const found = movies.find(m => (m.title && m.title.toLowerCase() === title) || (m.title_es && m.title_es.toLowerCase() === title));
      if(found && found.img){
        const src = String(found.img).replace(/"/g,'');
        const alt = (found.title_es || found.title || 'P√≥ster').replace(/"/g,'');
        return `<img src="${src}" alt="${alt}" style="width:100%; height:100%; object-fit:cover; border-radius: inherit;">`;
      }
    }

    // Fallback: initials box (keeps previous appearance)
    const titleText = (typeof movieOrTitle === 'string') ? movieOrTitle : (movieOrTitle && (movieOrTitle.title || movieOrTitle.title_es)) || '';
    const initials = titleText.split(' ').slice(0,2).map(w=>w[0]||'').join('').toUpperCase() || 'üé¨';
    return `<div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;font-size:28px;background:linear-gradient(135deg,#ff6b6b,#b23b3b);color:white;border-radius:inherit">
      <div style="font-weight:900">${initials}</div>
    </div>`;
  }


  // small escape to use full description in title attribute safely
  function escapeHtml(str){
    return String(str||'').replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
  }

  // ------------------------
  // Card renderer
  // ------------------------
  function cardElement(m, showTimes = true){
    const titleDisplay = m.title_es || m.title;
    const wrapper = document.createElement('article');
    wrapper.className = 'card';
    wrapper.dataset.id = m.id;

    const timesHtml = showTimes && (m.times||[]).length
    ? (m.times||[]).slice(0,6).map(t=>`<button class="time-btn" data-id="${m.id}" data-time="${t}">${t}</button>`).join('')
    : '';

    // TRUNCATE description for cards so the boxes don't show the full text.
    // Full description will still appear when clicking the card (details panel / modal).
    const desc = m.desc || '';
    const MAX_CHARS = 110; // adjust length as desired
    const descShort = desc.length > MAX_CHARS ? desc.slice(0, MAX_CHARS).trim() + '‚Ä¶' : desc;

    wrapper.innerHTML = `
    <div class="thumb" aria-hidden>${posterSVG(m.title)}</div>
    <h3>${titleDisplay}</h3>
    <div class="meta"><span class="rating">${m.score}</span><span>${m.genre}</span><span>${m.runtime}</span></div>
    <p style="color:var(--muted);margin-top:.45rem;font-size:.92rem" title="${escapeHtml(desc)}">${descShort}</p>
    ${ timesHtml ? `<div class="showtimes" style="margin-top:.6rem">${timesHtml}</div>` : (m.upcoming ? `<div style="margin-top:.6rem;color:var(--muted);font-size:.9rem">Pr√≥ximamente ‚Äî funciones por anunciar</div>` : '') }
    `;
    return wrapper;
  }

  // ------------------------
  // Render rows: available + upcoming
  // ------------------------
  function renderRows(filteredAvailable, filteredUpcoming){
    moviesRow.innerHTML = '';
    filteredAvailable.forEach(m=>{
      moviesRow.appendChild(cardElement(m, true));
    });
    upcomingRow.innerHTML = '';
    filteredUpcoming.forEach(m=>{
      upcomingRow.appendChild(cardElement(m, false));
    });
  }

  // ------------------------
  // Hero rendering
  // ------------------------
  let featuredIndex = 0;
  function featuredList(){ return movies.filter(m=>m.featured); }

  function renderHero(){
    const list = featuredList();
    if(list.length===0){
      heroFeatured.innerHTML = `<div style="color:var(--muted)">No hay destacados</div>`;
      return;
    }
    if(featuredIndex >= list.length) featuredIndex = 0;
    if(featuredIndex < 0) featuredIndex = list.length - 1;
    const featured = list[featuredIndex];
    const titleDisplay = featured.title_es || featured.title;
    heroFeatured.innerHTML = `
    <div class="poster" aria-hidden>${posterSVG(featured.title)}</div>
    <div class="movie-info">
      <h2>${titleDisplay}</h2>
      <p>${featured.desc}</p>
      <div style="margin-top:.4rem" class="meta"><span class="rating">${featured.score}</span><span>${featured.genre}</span><span>${featured.runtime}</span></div>
    </div>
    `;
  }

  // ------------------------
  // Show details panel
  // ------------------------
  function showDetails(movie){
    if(!movie) return;
    const titleDisplay = movie.title_es || movie.title;
    if(movie.upcoming){
      detailContent.innerHTML = `<div style="font-weight:800">${titleDisplay} ‚Äî Pr√≥ximamente</div>
        <div style="color:var(--muted);margin-top:.35rem">${movie.desc}</div>
        <div style="margin-top:.5rem" class="meta"><span class="rating">${movie.score}</span><span>${movie.genre}</span><span>${movie.runtime}</span></div>
        <div style="margin-top:.6rem;color:var(--muted);font-size:.9rem">Esta pel√≠cula est√° marcada como "Pr√≥ximamente". Las funciones y reservas se habilitar√°n en una fecha posterior.</div>`;
    } else {
      const timesHtml = (movie.times||[]).map(t=>`<button class="time-btn" data-id="${movie.id}" data-time="${t}">${t}</button>`).join('');
      detailContent.innerHTML = `<div style="font-weight:800">${titleDisplay}</div>
        <div style="color:var(--muted);margin-top:.35rem">${movie.desc}</div>
        <div style="margin-top:.5rem" class="meta"><span class="rating">${movie.score}</span><span>${movie.genre}</span><span>${movie.runtime}</span></div>
        <div style="margin-top:.6rem"><div style="font-weight:800">Funciones</div><div class="time-list" style="margin-top:.35rem">${timesHtml}</div></div>
        <div style="margin-top:.6rem;color:var(--muted);font-size:.9rem">Haga click en una hora para reservar inmediatamente.</div>`;
    }
    activateTabByPanel('panel-detalles');
    document.getElementById('panel-detalles').scrollIntoView({behavior:'smooth', block:'start'});
  }

  // ------------------------
  // Seats logic
  // ------------------------
  // current selection in modal
  let currentModal = { movieId: null, time: null };
  let selectedSeats = []; // array of seat ids currently selected in modal

  // create seat ids rows A-E and cols 1-8
  const SEAT_ROWS = ['A','B','C','D','E'];
  const SEAT_COLS = 8;

  function renderSeatMap(movieId, time){
    seatMapEl.innerHTML = '';
    const movie = movies.find(m=>m.id==movieId);
    if(!movie || movie.upcoming || !time){ seatMapEl.innerHTML = '<div style="color:var(--muted);margin-top:.4rem">Selecciona una funci√≥n v√°lida para ver butacas.</div>'; return; }
    const reserved = movie.reserved && movie.reserved[time] ? movie.reserved[time] : [];
    // build grid
    SEAT_ROWS.forEach(row=>{
      for(let c=1;c<=SEAT_COLS;c++){
        const seatId = `${row}${c}`;
        const btn = document.createElement('button');
        btn.className = 'seat';
        btn.type = 'button';
        btn.dataset.seat = seatId;
        btn.dataset.id = movieId;
        btn.dataset.time = time;
        btn.textContent = seatId;
        if(reserved.includes(seatId)){
          btn.classList.add('reserved');
          btn.disabled = true;
        } else if(selectedSeats.includes(seatId)){
          btn.classList.add('selected');
        }
        seatMapEl.appendChild(btn);
      }
    });
  }

  // ------------------------
  // Modal open/close
  // ------------------------
  function openModal(movieId, time){
    const m = movies.find(x=>x.id==movieId);
    if(!m) return;
    if(m.upcoming){
      bookingMessage.textContent = 'Esta pel√≠cula es pr√≥ximamente ‚Äî no tiene funciones disponibles.';
      return;
    }
    currentModal.movieId = movieId;
    currentModal.time = time || (m.times && m.times[0]);
    selectedSeats = []; // reset selection cada apertura
    const titleDisplay = m.title_es || m.title;
    modalTitle.textContent = `${titleDisplay} ‚Äî ${currentModal.time || ''}`;
    modalPoster.innerHTML = posterSVG(m.title);
    modalInfo.innerHTML = `<div style="font-weight:800">${titleDisplay}</div><div style="color:var(--muted);margin-top:.35rem">${m.desc}</div>`;
    modalTimes.innerHTML = (m.times||[]).map(t=>`<button class="time-btn" data-time="${t}" data-id="${m.id}">${t}</button>`).join('');
    overlay.classList.add('open');
    overlay.setAttribute('aria-hidden','false');
    bookingMessage.textContent = '';
    ticketCount.value = "1";
    // ensure reserved map has the time
    m.reserved = m.reserved || {};
    if(currentModal.time && !m.reserved[currentModal.time]) m.reserved[currentModal.time] = [];
    renderSeatMap(movieId, currentModal.time);
  }

  function closeModalFunc(){
    overlay.classList.remove('open');
    overlay.setAttribute('aria-hidden','true');
    currentModal = { movieId: null, time: null };
    selectedSeats = [];
  }

  // ------------------------
  // Global click handling (delegation)
  // ------------------------
  document.body.addEventListener('click', e=>{
    // If clicked a card anywhere -> show details (cards for upcoming will show non-bookable details)
    const card = e.target.closest('.card');
    if(card && !e.target.classList.contains('time-btn')){
      const id = Number(card.dataset.id);
      const m = movies.find(x=>x.id===id);
      if(m) showDetails(m);
      return;
    }

    // Click on time buttons (in cards, details or modal) -> open modal or highlight
    const timeBtn = e.target.closest('.time-btn');
    if(timeBtn){
      const id = Number(timeBtn.dataset.id);
      const t = timeBtn.dataset.time;
      const parent = timeBtn.parentElement;
      if(parent){
        Array.from(parent.querySelectorAll('.time-btn')).forEach(b=>b.style.borderColor='rgba(255,255,255,0.04)');
      }
      timeBtn.style.borderColor = 'var(--accent)';
      if(!timeBtn.closest('.modal')){
        openModal(id, t);
      } else {
        // time clicked inside modal: change seat map for that time
        const mid = Number(timeBtn.dataset.id);
        currentModal.movieId = mid;
        currentModal.time = t;
        selectedSeats = [];
        renderSeatMap(mid, t);
      }
      return;
    }

    // Seat click inside modal (delegated)
    const seatBtn = e.target.closest('.seat');
    if(seatBtn && seatBtn.dataset.seat){
      if(seatBtn.classList.contains('reserved')) return; // cannot toggle reserved
      const seatId = seatBtn.dataset.seat;
      const index = selectedSeats.indexOf(seatId);
      if(index >= 0){
        selectedSeats.splice(index,1);
        seatBtn.classList.remove('selected');
      } else {
        // optional: limit by ticketCount
        const max = Number(ticketCount.value || 1);
        if(selectedSeats.length >= max){
          // replace oldest selection with new (simple behavior) or deny ‚Äî here deny and notify
          bookingMessage.textContent = `Selecciona m√°ximo ${max} butaca(s).`;
          setTimeout(()=> bookingMessage.textContent = '', 1400);
          return;
        }
        selectedSeats.push(seatId);
        seatBtn.classList.add('selected');
      }
      return;
    }

    // Quick actions: confirm purchase
    if(e.target.id === 'confirmBuy'){
      if(!currentModal.movieId || !currentModal.time){
        bookingMessage.textContent = 'Seleccione funci√≥n antes de confirmar.';
        return;
      }
      const movie = movies.find(m=>m.id === currentModal.movieId);
      if(!movie){ bookingMessage.textContent = 'Pel√≠cula no encontrada.'; return; }
      if(selectedSeats.length === 0){
        bookingMessage.textContent = 'Debe seleccionar al menos una butaca.';
        return;
      }
      // ensure reserved array exists
      movie.reserved = movie.reserved || {};
      if(!movie.reserved[currentModal.time]) movie.reserved[currentModal.time] = [];
      // check if any seat got reserved meanwhile
      const conflict = selectedSeats.filter(s => movie.reserved[currentModal.time].includes(s));
      if(conflict.length){
        bookingMessage.textContent = `Las butacas ${conflict.join(', ')} ya est√°n reservadas. Actualiza la selecci√≥n.`;
        renderSeatMap(movie.id, currentModal.time);
        selectedSeats = [];
        return;
      }
      bookingMessage.textContent = 'Procesando...';
      setTimeout(()=>{
        // add selected seats to reserved list (avoid duplicates)
        selectedSeats.forEach(s=>{
          if(!movie.reserved[currentModal.time].includes(s)) movie.reserved[currentModal.time].push(s);
        });
        bookingMessage.textContent = `¬°Butacas reservadas: ${selectedSeats.join(', ')}! Confirmaci√≥n enviada (demo).`;
        confirmContent.innerHTML = `<div style="font-weight:800">Compra realizada</div><div style="color:var(--muted);margin-top:.4rem">Se han reservado tus butacas: ${selectedSeats.join(', ')} (Demo)</div>`;
        // clear selection and update seat map
        selectedSeats = [];
        renderSeatMap(movie.id, currentModal.time);
        activateTabByPanel('panel-confirmacion');
        closeModalFunc();
      },900);
      return;
    }

    // Hero quick open
    if(e.target.id === 'viewNow'){
      const available = movies.filter(m=>!m.upcoming);
      const first = available[0] || movies[0];
      if(first) showDetails(first);
      window.scrollTo({top:document.querySelector('main').offsetTop-60,behavior:'smooth'});
      return;
    }

    if(e.target.id === 'browse'){
      activateTabByPanel('panel-peliculas');
      window.scrollTo({top:document.querySelector('main').offsetTop-40,behavior:'smooth'});
      return;
    }

    if(e.target.id === 'quickBookFeatured'){
      const featured = featuredList()[0] || movies[0];
      // open modal for first available time
      const t = (featured.times||[])[0];
      if(!t){
        bookingMessage.textContent = 'La pel√≠cula destacada no tiene funciones disponibles.';
        return;
      }
      openModal(featured.id, t);
      return;
    }

    // close modal by clicking overlay or close button
    if(e.target === closeModal || e.target === overlay){
      closeModalFunc();
      return;
    }

    // nav links that have data-tab attribute
    const navLink = e.target.closest('[data-tab]');
    if(navLink && navLink.dataset.tab){
      const map = {
        'peliculas':'panel-peliculas',
        'proximamente':'panel-proximas',
        'ofertas':'panel-ofertas'
      };
      const panel = map[navLink.dataset.tab] || 'panel-peliculas';
      activateTabByPanel(panel);
      e.preventDefault();
    }
  });

  // keyboard escape to close modal
  document.addEventListener('keydown', e=>{
    if(e.key === 'Escape') closeModalFunc();
  });

  // ------------------------
  // Search + filtro
  // ------------------------
  function applyFilters(){
    const q = search.value.trim().toLowerCase();
    const genre = genreFilter.value;
    const filtered = movies.filter(m=>{
      const title = (m.title_es || m.title).toLowerCase();
      const matchQ = !q || title.includes(q) || (m.desc||'').toLowerCase().includes(q);
      const matchG = !genre || m.genre===genre;
      return matchQ && matchG;
    });
    const available = filtered.filter(m=>!m.upcoming);
    const upcoming = filtered.filter(m=>m.upcoming);
    renderRows(available, upcoming);
    nowCount.textContent = `${available.length} t√≠tulos`;
  }

  search.addEventListener('input', applyFilters);
  genreFilter.addEventListener('change', applyFilters);

  // ------------------------
  // Inicializa vistas
  // ------------------------
  function initRender(){
    const available = movies.filter(m=>!m.upcoming);
    const upcoming = movies.filter(m=>m.upcoming);
    renderRows(available, upcoming);
    nowCount.textContent = `${available.length} t√≠tulos`;
    renderHero();
  }
  initRender();

  // ------------------------
  // Tabs logic
  // ------------------------
  const tabButtons = document.querySelectorAll('.tab-btn');
  tabButtons.forEach(btn=>{
    btn.addEventListener('click', ()=> {
      const panel = btn.dataset.panel;
      activateTabByPanel(panel);
    });
  });

  function activateTabByPanel(panelId){
    tabButtons.forEach(b=>{
      if(b.dataset.panel === panelId){
        b.classList.add('active');
        b.setAttribute('aria-selected','true');
      } else {
        b.classList.remove('active');
        b.setAttribute('aria-selected','false');
      }
    });
    document.querySelectorAll('.tab-panel').forEach(p=>{
      if(p.id === panelId){
        p.classList.add('active');
        p.removeAttribute('aria-hidden');
        p.scrollIntoView({behavior:'smooth', block:'start'});
      } else {
        p.classList.remove('active');
        p.setAttribute('aria-hidden','true');
      }
    });
    if(panelId === 'panel-proximas'){
      const upcoming = movies.filter(m=>m.upcoming);
      renderRows(movies.filter(m=>!m.upcoming), upcoming);
    }
  }

  // ------------------------
  // Forms: login & register (demo)
  // ------------------------
  document.getElementById('loginForm').addEventListener('submit', e=>{
    e.preventDefault();
    document.getElementById('loginMsg').textContent = 'Iniciando sesi√≥n...';
    setTimeout(()=>{ document.getElementById('loginMsg').textContent = 'Sesi√≥n iniciada (demo).'; activateTabByPanel('panel-peliculas'); },800);
  });

  document.getElementById('registerForm').addEventListener('submit', e=>{
    e.preventDefault();
    document.getElementById('registerMsg').textContent = 'Creando cuenta...';
    setTimeout(()=>{ document.getElementById('registerMsg').textContent = 'Cuenta creada (demo).'; activateTabByPanel('panel-login'); },900);
  });

  document.getElementById('goRegister').addEventListener('click', ()=> activateTabByPanel('panel-registrar'));
  document.getElementById('goLogin').addEventListener('click', ()=> activateTabByPanel('panel-login'));

  // accessibility: trap focus inside modal when open (b√°sico)
  overlay.addEventListener('keydown', e=>{
    if(e.key==='Tab'){
      const focusable = overlay.querySelectorAll('button, [href], input, select, textarea');
      if(focusable.length===0) return;
      const first = focusable[0], last = focusable[focusable.length-1];
      if(e.shiftKey && document.activeElement===first){ last.focus(); e.preventDefault(); }
      else if(!e.shiftKey && document.activeElement===last){ first.focus(); e.preventDefault(); }
    }
  });

  // Hero controls
  document.getElementById('heroPrev').addEventListener('click', ()=>{
    featuredIndex--;
    renderHero();
  });
  document.getElementById('heroNext').addEventListener('click', ()=>{
    featuredIndex++;
    renderHero();
  });

  // Simple horizontal scroll controls for moviesRow (wheel support)
  moviesRow.addEventListener('wheel', e=>{
    if(Math.abs(e.deltaX) < Math.abs(e.deltaY)){
      moviesRow.scrollLeft += e.deltaY;
      e.preventDefault();
    }
  });

  // Modal time selection inside modal (delegated)
  modalTimes.addEventListener('click', e=>{
    const b = e.target.closest('.time-btn');
    if(!b) return;
    Array.from(modalTimes.querySelectorAll('.time-btn')).forEach(x=>x.style.borderColor='rgba(255,255,255,0.04)');
    b.style.borderColor = 'var(--accent)';
    // change seatmap to selected time
    const id = Number(b.dataset.id);
    const t = b.dataset.time;
    currentModal.movieId = id;
    currentModal.time = t;
    selectedSeats = [];
    renderSeatMap(id, t);
  });

  // Initialize filter input listeners and first render
  applyFilters();
  </script>
</body>
</html>
